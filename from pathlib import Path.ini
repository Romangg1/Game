from pathlib import Path
from tkinter import Tk, Canvas, Button, PhotoImage, messagebox
import random

OUTPUT_PATH = Path(__file__).parent
ASSETS_PATH = OUTPUT_PATH / Path(r"C:\Users\alexp\OneDrive\desktop\build\assets\frame0")

def relative_to_assets(path: str) -> Path:
    return ASSETS_PATH / Path(path)

window = Tk()
window.geometry("1600x845")
window.configure(bg="#FFFFFF")

canvas = Canvas(window, bg="#FFFFFF", height=845, width=1600, bd=0, highlightthickness=0, relief="ridge")
canvas.place(x=0, y=0)

rectangles = [
    (51.0, 60.0, 181.0, 280.0, "#AD7F3A"),
    (1431.0, 60.0, 1561.0, 280.0, "#AE354B"),
    (1431.0, 347.0, 1561.0, 567.0, "#AD354B"),
    (51.0, 347.0, 181.0, 567.0, "#659CC4"),
]

yellow_blocks = [
    (329.0, 381.0, 419.0, 551.0),
    (426.0, 381.0, 516.0, 551.0),
    (523.0, 381.0, 613.0, 551.0),
    (620.0, 381.0, 710.0, 551.0),
    (717.0, 381.0, 807.0, 551.0),
    (814.0, 381.0, 904.0, 551.0),
    (911.0, 381.0, 1001.0, 551.0),
    (1008.0, 381.0, 1098.0, 551.0),
    (1105.0, 381.0, 1195.0, 551.0),
    (1202.0, 381.0, 1292.0, 551.0),
    (1299.0, 381.0, 1389.0, 551.0),
    (232.0, 381.0, 322.0, 551.0),
    (329.0, 100.0, 419.0, 270.0),
    (426.0, 100.0, 516.0, 270.0),
    (523.0, 100.0, 613.0, 270.0),
    (620.0, 100.0, 710.0, 270.0),
    (717.0, 100.0, 807.0, 270.0),
    (814.0, 100.0, 904.0, 270.0),
    (911.0, 100.0, 1001.0, 270.0),
    (1008.0, 100.0, 1098.0, 270.0),
    (1105.0, 100.0, 1195.0, 270.0),
    (1202.0, 100.0, 1292.0, 270.0),
    (1299.0, 100.0, 1389.0, 270.0),
    (232.0, 100.0, 322.0, 270.0)
]

# Создание прямоугольников из списка
for rect in rectangles:
    canvas.create_rectangle(rect[0], rect[1], rect[2], rect[3], fill=rect[4], outline="")

# Создание желтых прямоугольников
yellow_block_ids = []
for block in yellow_blocks:
    rect_id = canvas.create_rectangle(block[0], block[1], block[2], block[3], fill="#F6FB00", outline="")
    yellow_block_ids.append(rect_id)

# Добавление изображения "pirat.png" в правый нижний желтый квадрат
pirat_image = PhotoImage(file=relative_to_assets("pirat.png"))
pirat_id = canvas.create_image(1098.0, 551.0, image=pirat_image, anchor="sw", tag="pirat")
canvas.image_pirat = pirat_image

# Переменные для хранения состояния и данных
selected_block = None
highlighted_block = None
stop_animation = [False]

def on_pirat_click(event):
    global highlighted_block
    # Увеличение изображения "pirat" на 5 пикселей в каждую сторону
    canvas.delete("highlight")
    if highlighted_block:
        canvas.delete(highlighted_block)
    
    # Вычисление текущих координат пират
    x1, y1, x2, y2 = canvas.bbox("pirat")
    
    for block in yellow_blocks:
        if block[0] <= x2 <= block[2] and block[1] <= y2 <= block[3]:
            highlighted_block = canvas.create_rectangle(block[0], block[1], block[2], block[3], outline="red", width=2, tag="highlight")
            break

def on_block_click(event):
    global highlighted_block
    if highlighted_block:
        canvas.delete(highlighted_block)
        highlighted_block = None
    
    for index, block in enumerate(yellow_blocks):
        if block[0] <= event.x <= block[2] and block[1] <= event.y <= block[3]:
            # Перемещение пират на выбранный блок
            canvas.coords(pirat_id, (block[0] + block[2]) / 2, (block[1] + block[3]) / 2)
            print(f"Пират перемещен на координаты: ({(block[0] + block[2]) / 2}, {(block[1] + block[3]) / 2})")
            break

def update_random_image_1():
    random_image_number = random.randint(1, 6)
    random_image_path = relative_to_assets(f"{random_image_number}.png")
    random_image = PhotoImage(file=random_image_path)
    
    canvas.delete("image1")
    canvas.create_image(688.0, 702.0, image=random_image, tag="image1")
    canvas.image1 = random_image

    print(f"Отображено изображение: {random_image_number}.png на координатах (688.0, 702.0)")

    if not stop_animation[0]:
        window.after(100, update_random_image_1)

def update_random_image_2():
    random_image_number = random.randint(1, 6)
    random_image_path = relative_to_assets(f"{random_image_number}.png")
    random_image = PhotoImage(file=random_image_path)
    
    canvas.delete("image2")
    canvas.create_image(838.0, 702.0, image=random_image, tag="image2")
    canvas.image2 = random_image

    print(f"Отображено изображение: {random_image_number}.png на координатах (838.0, 702.0)")

    if not stop_animation[0]:
        window.after(100, update_random_image_2)

def move_pirat(steps):
    current_x, current_y = canvas.coords(pirat_id)
    block_width = 90  # Ширина одного желтого блока
    new_x = current_x - (steps * block_width)
    canvas.coords(pirat_id, new_x, current_y)
    print(f"Изображение перемещено на {steps} блоков влево")

def start_random_images():
    global stop_animation
    stop_animation[0] = False
    update_random_image_1()
    update_random_image_2()
    window.after(1000, show_final_images)

def show_final_images():
    global stop_animation
    stop_animation[0] = True
    final_image_number1 = random.randint(1, 6)
    final_image_path1 = relative_to_assets(f"{final_image_number1}.png")
    final_image1 = PhotoImage(file=final_image_path1)
    canvas.delete("image1")
    canvas.create_image(688.0, 702.0, image=final_image1, tag="image1")
    canvas.image1 = final_image1
    print(f"Окончательное изображение: {final_image_number1}.png на координатах (688.0, 702.0)")

    final_image_number2 = random.randint(1, 6)
    final_image_path2 = relative_to_assets(f"{final_image_number2}.png")
    final_image2 = PhotoImage(file=final_image_path2)
    canvas.delete("image2")
    canvas.create_image(838.0, 702.0, image=final_image2, tag="image2")
    canvas.image2 = final_image2
    print(f"Окончательное изображение: {final_image_number2}.png на координатах (838.0, 702.0)")

# Кнопка для запуска случайных изображений
button_image_1 = PhotoImage(file=relative_to_assets("bros.png"))
button_1 = Button(image=button_image_1, borderwidth=0, highlightthickness=0, command=start_random_images, relief="flat")
button_1.place(x=1008.0, y=653.0, width=281.0, height=104.0)

# Привязка обработчиков событий
canvas.tag_bind("pirat", "<Button-1>", on_pirat_click)
for block_id in yellow_block_ids:
    canvas.tag_bind(block_id, "<Button-1>", on_block_click)

window.mainloop()